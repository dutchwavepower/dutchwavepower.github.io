{{- /* Define src attribute - Manual Query Params. */}}
{{- $host := cond $pc.PrivacyEnhanced "www.youtube-nocookie.com" "www.youtube.com" }}
{{- $src := printf "https://%s/embed/%s" $host $id }}

{{- $queryParams := slice }}

{{- if eq $autoplay 1 }}
    {{ $queryParams = $queryParams | append "autoplay=1" }}
    {{ $queryParams = $queryParams | append "mute=1" }} {{/* Autoplay implies mute */}}
{{- else if eq $mute 1 }}
    {{ $queryParams = $queryParams | append "mute=1" }}
{{- end }}

{{- if eq $controls 0 }}
    {{ $queryParams = $queryParams | append "controls=0" }}
{{- end }}

{{- if gt $end 0 }}
    {{ $queryParams = $queryParams | append (printf "end=%d" $end) }}
{{- end }}

{{- if eq $loop 1 }}
    {{ $queryParams = $queryParams | append "loop=1" }}
    {{ $queryParams = $queryParams | append (printf "playlist=%s" $id) }} {{/* Loop requires playlist ID */}}
{{- end }}

{{- if gt $start 0 }}
    {{ $queryParams = $queryParams | append (printf "start=%d" $start) }}
{{- end }}

{{- if gt (len $queryParams) 0 }}
    {{- $src = printf "%s?%s" $src (delimit $queryParams "&") }}
{{- end }}
