{{- $resource_page := .resource_page -}}
{{- $name := .name -}}
{{- $class := .class -}}
{{- $alt := .alt -}}
{{- $logo_style := .logo_style | default "" -}}

{{- $image := "" -}}
{{- $imgWidth := "" -}}
{{- $imgHeight := "" -}}

{{- with $resource_page -}}
    {{- /* Check if resource_page is a Page object. If so, access its .Resources.
           Otherwise, assume it's already a collection of resources (e.g., Page.Resources). */ -}}
    {{- if ($resource_page | default false).IsPage -}}
        {{- $image = $resource_page.Resources.Get $name -}}
    {{- else -}}
        {{- /* This path specifically handles the previous Hugo error (can't evaluate field Get in type resource.Resources),
               as it assumes '.' is already a resource collection and calls .Get directly. */ -}}
        {{- $image = .Get $name -}}
    {{- end -}}

    {{- if not $image -}}
        {{- /* Final fallback to site-wide resources if not found via page or passed collection */ -}}
        {{- $image = $.Site.Resources.Get $name -}}
    {{- end -}}
{{- else -}}
    {{- /* If no resource_page is provided (e.g., it's nil), try site-wide resources as default */ -}}
    {{- $image = $.Site.Resources.Get $name -}}
{{- end -}}

{{- if $image -}}
    {{- /* Get natural dimensions from the image resource for width/height attributes */ -}}
    {{- $imgWidth = $image.NaturalWidth -}}
    {{- $imgHeight = $image.NaturalHeight -}}

    <img src="{{ $image.RelPermalink }}"
        alt="{{ $alt }}"
        class="{{ $class }}"
        style="{{ $logo_style | safeCSS }}"
        {{ with $imgWidth }}width="{{ . }}"{{ end }}
        {{ with $imgHeight }}height="{{ . }}"{{ end }}
    >
{{- else -}}
    {{- errorf "Image '%s' not found for logo banner. Please ensure the image exists and is correctly referenced in content/index.md or as a site resource." $name -}}
{{- end -}}
