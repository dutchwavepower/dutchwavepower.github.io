{{- $resource_page := .resource_page -}}
{{- $name := .name -}}
{{- $class := .class -}}
{{- $alt := .alt -}}
{{- $logo_style := .logo_style | default "" -}} {{/* Use logo_style as passed from index.md */}}

{{- $image := "" -}}
{{- $imgWidth := "" -}}
{{- $imgHeight := "" -}}

{{- with $resource_page -}}
    {{- /* Try to get image from page bundle resources first (e.g., if image is in same folder as markdown) */ -}}
    {{- $image = .Resources.Get $name -}}
    {{- if not $image -}}
        {{- /* Fallback to site-wide resources if not found on page (e.g., from static/images or global assets) */ -}}
        {{- $image = $.Site.Resources.Get $name -}}
    {{- end -}}
{{- else -}}
    {{- /* If no resource_page context is provided at all, try site-wide resources as default */ -}}
    {{- $image = $.Site.Resources.Get $name -}}
{{- end -}}

{{- if $image -}}
    {{- /* Get natural dimensions from the image resource for width/height attributes */ -}}
    {{- $imgWidth = $image.NaturalWidth -}}
    {{- $imgHeight = $image.NaturalHeight -}}

    <img src="{{ $image.RelPermalink }}"
        alt="{{ $alt }}"
        class="{{ $class }}"
        style="{{ $logo_style | safeCSS }}" {{/* Apply logo_style as an inline style */}}
        {{ with $imgWidth }}width="{{ . }}"{{ end }}
        {{ with $imgHeight }}height="{{ . }}"{{ end }}
    >
{{- else -}}
    {{- /* Provide a more informative error if image is not found */ -}}
    {{- errorf "Image '%s' not found for logo banner. Please ensure the image exists and is correctly referenced in content/index.md or as a site resource. Context: %s" $name ($resource_page.RelPermalink | default "N/A") -}}
{{- end -}}
